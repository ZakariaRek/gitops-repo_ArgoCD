apiVersion: v1
kind: ConfigMap
metadata:
  name: kibana-config
  namespace: infrastructure
  labels:
    app: kibana
    component: infrastructure
    tier: logging
data:
  kibana.yml: |
    # Server configuration
    server.name: "kibana"
    server.host: "0.0.0.0"
    server.port: 5601
    server.publicBaseUrl: "http://kibana.infrastructure.svc.cluster.local:5601"
    
    # Elasticsearch configuration - FIXED: Removed invalid keys
    elasticsearch.hosts: ["http://elasticsearch.infrastructure.svc.cluster.local:9200"]
    elasticsearch.username: ""
    elasticsearch.password: ""
    # Removed: elasticsearch.requestTimeout, elasticsearch.shardTimeout, elasticsearch.pingTimeout, elasticsearch.startupTimeout
    # These are not valid in Kibana 8.x
    
    # Security configuration (disabled for development)
    xpack.security.enabled: false
    xpack.encryptedSavedObjects.encryptionKey: "something_at_least_32_characters_long"
    
    # Monitoring configuration - FIXED: Updated for 8.x
    monitoring.ui.container.elasticsearch.enabled: true
    monitoring.kibana.collection.enabled: false
    
    # Logging configuration
    logging:
      root:
        level: info
      appenders:
        default:
          type: console
          layout:
            type: json
    
    # UI configuration
    i18n.locale: "en"
    
    # Index patterns
    kibana.index: ".kibana"
    
    # Save objects
    savedObjects.maxImportPayloadBytes: 26214400
    savedObjects.maxImportExportSize: 10000
    
    # Path configuration
    path.data: /usr/share/kibana/data
    
    # Elasticsearch client configuration for 8.x
    elasticsearch.serviceAccountToken: ""
    elasticsearch.ssl.verificationMode: none