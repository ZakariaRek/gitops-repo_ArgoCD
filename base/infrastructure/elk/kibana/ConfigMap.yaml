apiVersion: v1
kind: ConfigMap
metadata:
  name: kibana-config
  namespace: infrastructure
  labels:
    app: kibana
    component: infrastructure
    tier: logging
data:
  kibana.yml: |
    # Server configuration
    server.name: "kibana"
    server.host: "0.0.0.0"
    server.port: 5601
    server.publicBaseUrl: "http://kibana.infrastructure.svc.cluster.local:5601"
    
    # Elasticsearch configuration - FIXED: Cleaned up for 8.x
    elasticsearch.hosts: ["http://elasticsearch.infrastructure.svc.cluster.local:9200"]
    
    # Security configuration - FIXED: Properly disabled
    xpack.security.enabled: false
    xpack.encryptedSavedObjects.encryptionKey: "something_at_least_32_characters_long_for_development_only_use"
    
    # Monitoring configuration - FIXED: Updated for 8.x compatibility
    monitoring.ui.container.elasticsearch.enabled: true
    monitoring.kibana.collection.enabled: false
    
    # Logging configuration
    logging:
      root:
        level: info
      appenders:
        default:
          type: console
          layout:
            type: json
    
    # UI configuration
    i18n.locale: "en"
    
    # Index patterns
    kibana.index: ".kibana"
    
    # Save objects
    savedObjects.maxImportPayloadBytes: 26214400
    savedObjects.maxImportExportSize: 10000
    
    # Path configuration
    path.data: /usr/share/kibana/data
    
    # FIXED: Removed problematic 8.x incompatible settings
    # - elasticsearch.serviceAccountToken (causes conflicts)
    # - elasticsearch.ssl.verificationMode (not needed when security disabled)