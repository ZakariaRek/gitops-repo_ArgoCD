apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: product-service
  namespace: microservices

resources:
- Deployment.yaml
- Service.yaml
- ConfigMap.yaml
- Secret.yaml

# Use 'labels' instead of deprecated 'commonLabels'
labels:
- pairs:
    app: product-service
    component: microservices
    version: latest

images:
- name: yahyazakaria123/ecommerce-app-product-service
  newTag: latest

namespace: microservices

replicas:
- name: product-service
  count: 2

configMapGenerator:
- name: product-service-env-config
  literals:
  - SPRING_PROFILES_ACTIVE=docker,kafka
  - LOG_LEVEL=INFO
  - PRODUCT_CACHE_TTL=3600
  - PRODUCT_PAGINATION_DEFAULT_SIZE=20

# Use the new patches syntax instead of deprecated patchesStrategicMerge
patches:
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: product-service
    spec:
      template:
        spec:
          containers:
          - name: product-service
            volumeMounts:
            - name: logs-volume
              mountPath: /app/logs
          volumes:
          - name: logs-volume
            emptyDir: {}
  target:
    kind: Deployment
    name: product-service