apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../../../../base/infrastructure/eureka-server

namespace: infrastructure

labels:
- pairs:
    environment: dev
    tier: development

images:
- name: yahyazakaria123/ecommerce-app-discovery-service
  newTag: latest  # Changed from dev-latest to latest

replicas:
- name: eureka-server
  count: 1

configMapGenerator:
- name: eureka-server-dev-config
  literals:
  - LOG_LEVEL=DEBUG
  - SPRING_PROFILES_ACTIVE=dev,docker

patches:
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: eureka-server
    spec:
      template:
        spec:
          containers:
          - name: eureka-server
            env:
            - name: SPRING_PROFILES_ACTIVE
              value: "dev,docker"
            - name: LOG_LEVEL
              value: "DEBUG"
            resources:
              requests:
                memory: "256Mi"
                cpu: "100m"
              limits:
                memory: "512Mi"
                cpu: "250m"
  target:
    kind: Deployment
    name: eureka-server
- patch: |-
    apiVersion: v1
    kind: Service
    metadata:
      name: eureka-server
    spec:
      type: NodePort
      ports:
      - name: http
        port: 8761
        targetPort: 8761
        nodePort: 30761
  target:
    kind: Service
    name: eureka-server